name: Test

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.8'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install flake8 pytest pytest-cov
        pip install -e .
    
    - name: Run flake8 tests (matches GitLab CI)
      run: flake8 fenicsR13 examples tests
    
    - name: Run pytest test collection (matches GitLab CI structure)
      run: pytest --collect-only
    
    - name: Validate input file copying feature
      run: |
        # Validate that our changes work syntactically by importing without FEniCS
        python -c "
        import sys
        import ast
        
        # Check that solver.py is syntactically valid
        with open('fenicsR13/solver.py', 'r') as f:
            code = f.read()
            try:
                ast.parse(code)
                print('solver.py syntax validation passed')
            except SyntaxError as e:
                print(f'Syntax error in solver.py: {e}')
                sys.exit(1)
                
        # Check that fenicsR13.py is syntactically valid  
        with open('fenicsR13/fenicsR13.py', 'r') as f:
            code = f.read()
            try:
                ast.parse(code)
                print('fenicsR13.py syntax validation passed')
            except SyntaxError as e:
                print(f'Syntax error in fenicsR13.py: {e}')
                sys.exit(1)
                
        print('All syntax validations passed')
        "